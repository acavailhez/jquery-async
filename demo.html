<!doctype html>
<html lang="en">
<head>
    <title>jQuery Async</title>

    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Jquery-async : jQuery plugin to animate buttons when an asynchronous process is waiting to complete (ajax, etc.)" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">


    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.9.0.min.js"></script>

    <script src="js/jquery.loader.js"></script>
    <script src="js/jquery.async.js"></script>

</head>
<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="https://github.com/acavailhez/jquery-async">View on GitHub</a>

        <h1 id="project_title">Jquery-async</h1>
        <h2 id="project_tagline">jQuery plugin to animate buttons when an asynchronous process is waiting to complete (ajax, etc.)</h2>

        <section id="downloads">
            <a class="zip_download_link" href="https://github.com/acavailhez/jquery-async/zipball/master">Download this project as a .zip file</a>
            <a class="tar_download_link" href="https://github.com/acavailhez/jquery-async/tarball/master">Download this project as a tar.gz file</a>
        </section>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">

        <br/>
        <br/>

        <h1 style="text-align: center;">jQuery Async Demo</h1>
        <p style="text-align: right"><a href="http://github.com/acavailhez/jquery-async">Project page &raquo;</a></p>

        <br/>
        <br/>
        <br/>

        <h3>Asynchronous button</h3>
        <p>Instead of using the .click() jQuery function, use the .async() to make your button visibly wait.</p>
        <p>The action can either succeed of fail, triggering a different animation on the button.</p>

        <a id="button1" class="btn btn-info"> Test asynchronous user action</a>
        <script>
            $('#button1').async(function(deferred){
                //we get a deferred object
                $('#button1-buttons').show();

                $('#button1-done').click(function(){
                    deferred.resolve();//we make the deferred resolve succesfully
                    $('#button1-buttons').hide();
                });
                $('#button1-fail').click(function(){
                    deferred.reject();//we make the deferred fail
                    $('#button1-buttons').hide();
                });
            });

        </script>
            <span id="button1-buttons" style="display:none;">
                <a id="button1-done" class="btn btn-success" >Action succeeds</a>
                <a id="button1-fail" class="btn btn-danger">Action failed</a>
            </span>


        <br/>
        <br/>
        <br/>

        <h3>Embed the params in the HTML attributes</h3>
        <p>If your javascript is bundled and minified, you cannot easily pass a page parameter like a user id to the javascript function.</p>
        <p>jQuery async does that for you by reading the async-params attribute of your button in a JSON format and deliver it in your code</p>

        <a async-function="asyncFunctionTest" async-params="{timeout:1500}" class="btn btn-info"> Test embedded params</a>
        <script>
            function asyncFunctionTest(deferred,params){
                setTimeout(function(){
                    deferred.resolve();
                },params.timeout);
            };
        </script>


        <br/>
        <br/>
        <br/>


        <h3>Different triggers</h3>
        <p>You can bind .async() on a different trigger than the usual "click" event</p>
        <p>In this example the async is binded to the "change" event so once you have typed in the postal code and you leave the input, the function is triggered:</p>

        <input async-bind="change" async-function="retrieveTemperature" type="text" placeholder="Type a US postal code, eg:94114" style="margin-bottom:0;width:240px"/>
        <span id="temperature4"></span>

        <script>
            function retrieveTemperature(deferred,params,$input){
                //the input is passed as a parameter
                var postal = $input.val();
                if(!postal || !$.isNumeric(postal)){
                    $('#temperature4').html('Please enter a postal code');
                    return false;//deferred.reject(); would have been equivalent
                }
                var yql = encodeURIComponent('select item from weather.forecast where location="' + postal +'"');

                //$.ajax returns a Promise object, which $().async can handle
                return $.ajax({
                    type: 'POST',
                    dataType:'jsonp',
                    url:'http://query.yahooapis.com/v1/public/yql?format=json&q='+yql,
                    success:function(json){
                        if(json.error){
                            $('#temperature4').html(json.error.description);
                            deferred.reject();
                            return;
                        }
                        else if(json.query.results.channel.item.condition){
                            $('#temperature4').html(json.query.results.channel.item.condition.temp+'Â°F');
                            deferred.resolve();
                        }
                        else{
                            $('#temperature4').html(json.query.results.channel.item.title);
                            deferred.reject();
                        }
                    }
                });
            };

        </script>

        <br/>
        <br/>
        <br/>


    </section>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">Jquery-async maintained by <a href="https://github.com/acavailhez">acavailhez</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
    </footer>
</div>


</body>
</html>
