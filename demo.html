<!doctype html>
<html lang="en">
<head>
    <title>jQuery Async</title>



    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.9.0.min.js"></script>

    <link href="css/jquery.loader.css" rel="stylesheet">

    <script src="js/jquery.loader.js"></script>
    <script src="js/jquery.async.js"></script>

</head>
<body>

<div class="container">
    <div class="row">
        <div class="span12">
            <h1 style="text-align: center;">jQuery Async Demo</h1>

            <h3>Asynchronous user action</h3>

            <a id="button1" class="btn btn-info"> Test asynchronous user action</a>
            <script>
                $('#button1').async(function(deferred){

                    $('#button1-buttons').show();

                    $('#button1-done').click(function(){
                        deferred.resolve();
                        $('#button1-buttons').hide();
                    });
                    $('#button1-fail').click(function(){
                        deferred.reject();
                        $('#button1-buttons').hide();
                    });
                });

            </script>
            <span id="button1-buttons" style="display:none;">
                <a id="button1-done" class="btn btn-success" >Action done</a>
                <a id="button1-fail" class="btn btn-danger">Action failed</a>
            </span>


            <br/>
            <br/>
            <br/>

            <h3>Ajax button</h3>

            <input type="text" id="input2" placeholder="Type a postal code" style="margin-bottom:0;"/>
            <a id="button2" class="btn btn-info" loading-text="Requesting"> Get temperature</a>
            <span id="temperature"></span>
            <script>

                $('#button2').async('ajax',{
                    type: 'POST',
                    dataType:'jsonp',
                    url: function(deferred){
                        //construct the url from the input, returns the url, or false if error
                        var postal = $('#input2').val();
                        if(!postal || !$.isNumeric(postal)){
                            $('#temperature').html('Please enter a postal code');
                            return false;
                        }
                        else{
                            var yql = encodeURIComponent('select item from weather.forecast where location="' + postal +'"');
                            return 'http://query.yahooapis.com/v1/public/yql?q=' + yql + '&format=json';
                        }
                    },
                    success:function(json,deferred){
                        if(json.query.results.channel.item.condition){
                            $('#temperature').html(json.query.results.channel.item.condition.temp+'Â°F');
                            deferred.resolve();
                        }
                        else{
                            $('#temperature').html(json.query.results.channel.item.title);
                            deferred.reject();
                        }
                    }
                });

            </script>

            <br/>
            <br/>
            <br/>

            <h3>Params embedded in HTML attributes</h3>
            <p>Buttons with an async-function attributes will automatically be converted to asynchronous buttons</p>

            <a async-function="asyncFunctionTest" async-params="{timeout:1500}" class="btn btn-info"> Test embedded params</a>
            <a async-bind="mouseenter" async-function="asyncFunctionTest" async-params="globalObject.values" class="btn btn-info"> Test embedded params 2</a>
            <script>
                function asyncFunctionTest(deferred,params){
                    setTimeout(function(){
                        deferred.resolve();
                    },params.timeout);
                };

                var globalObject = {
                    values:{
                        timeout:1000
                    }
                }

            </script>
        </div>
    </div>
</div>





</body>
</html>
